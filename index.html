<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/GoalifyLogo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Goalify</title>
    
    <!-- ìºì‹œ ë°©ì§€ ë©”íƒ€íƒœê·¸ (ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € ìºì‹œ ì´ìŠˆ í•´ê²°) -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <!-- Open Graph ë©”íƒ€íƒœê·¸ (ë§í¬ ê³µìœ  ì‹œ ë¯¸ë¦¬ë³´ê¸°) -->
    <meta property="og:title" content="Goalify" id="og-title" />
    <meta property="og:description" content="Plan. Play. Win." id="og-description" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="REPLACE_APP_URL" id="og-url" />
    <meta property="og:image" content="REPLACE_IMAGE_URL" id="og-image" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Goalify" id="twitter-title" />
    <meta name="twitter:description" content="Plan. Play. Win." id="twitter-description" />
    <meta name="twitter:image" content="REPLACE_IMAGE_URL" id="twitter-image" />
    
    <!-- ì´ˆê¸° íƒ€ì´í‹€ ë° OG íƒœê·¸ ë™ì  ë¡œë“œ + ìºì‹œ í´ë¦°ì—… -->
    <script>
      // âš ï¸ Vercel ë„ë©”ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²´í¬ (ê°€ì¥ ë¨¼ì € ì‹¤í–‰)
      (function() {
        const hostname = window.location.hostname;
        const redirectMap = {
          'semihan-football-manager.vercel.app': 'https://www.goalify.club/team/semihan-fc',
          'dksc-football-manager.vercel.app': 'https://www.goalify.club/team/dksc'
        };
        
        const newUrl = redirectMap[hostname];
        if (newUrl) {
          // ë¦¬ë‹¤ì´ë ‰íŠ¸ í˜ì´ì§€ í‘œì‹œ
          document.addEventListener('DOMContentLoaded', function() {
            const teamName = hostname.includes('semihan') ? 'Semihan FC' : 'DKSC';
            document.body.innerHTML = `
              <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;padding:20px;text-align:center;">
                <div style="background:white;border-radius:20px;padding:40px;max-width:500px;box-shadow:0 20px 60px rgba(0,0,0,0.3);">
                  <div style="font-size:64px;margin-bottom:20px;">ğŸš€</div>
                  <h1 style="font-size:28px;font-weight:700;color:#1a202c;margin:0 0 16px 0;">í˜ì´ì§€ê°€ ì´ì „ë˜ì—ˆìŠµë‹ˆë‹¤</h1>
                  <p style="font-size:16px;color:#4a5568;margin:0 0 32px 0;line-height:1.6;">
                    <strong>${teamName}</strong>ê°€ ìƒˆë¡œìš´ ì£¼ì†Œë¡œ ì´ì „í–ˆìŠµë‹ˆë‹¤.<br/>
                    ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒˆ í˜ì´ì§€ë¡œ ì´ë™í•˜ì„¸ìš”.
                  </p>
                  <button onclick="window.location.href='${newUrl}'" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;padding:16px 48px;font-size:18px;font-weight:600;border-radius:12px;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;box-shadow:0 4px 14px rgba(102,126,234,0.4);" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 20px rgba(102,126,234,0.6)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 14px rgba(102,126,234,0.4)'">
                    ìƒˆ í˜ì´ì§€ë¡œ ì´ë™í•˜ê¸° â†’
                  </button>
                  <p style="font-size:14px;color:#718096;margin:24px 0 0 0;">
                    5ì´ˆ í›„ ìë™ìœ¼ë¡œ ì´ë™ë©ë‹ˆë‹¤...
                  </p>
                </div>
              </div>
            `;
          });
          
          // 5ì´ˆ í›„ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸
          setTimeout(function() {
            window.location.href = newUrl;
          }, 5000);
          
          return; // ë‚˜ë¨¸ì§€ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¤‘ë‹¨
        }
      })();
      
      try {
        // ì•± ë²„ì „ ì²´í¬ ë° êµ¬ ìºì‹œ ì •ë¦¬
        const APP_VERSION = 'v2.0.0'; // ë©”ì´ì € ì—…ë°ì´íŠ¸ ì‹œ ë²„ì „ ë³€ê²½
        const lastVersion = localStorage.getItem('app_version');
        
        if (lastVersion !== APP_VERSION) {
          console.log('[Cache] Version changed, clearing old cache', lastVersion, '->', APP_VERSION);
          
          // êµ¬ ìºì‹œ í‚¤ ì •ë¦¬ (sfm:cache:* íŒ¨í„´)
          const keysToRemove = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && (key.startsWith('sfm:cache:') || key.includes(':prod'))) {
              keysToRemove.push(key);
            }
          }
          keysToRemove.forEach(key => {
            try {
              localStorage.removeItem(key);
            } catch (e) {
              console.warn('[Cache] Failed to remove', key, e);
            }
          });
          
          // ìƒˆ ë²„ì „ ê¸°ë¡
          localStorage.setItem('app_version', APP_VERSION);
          console.log('[Cache] Cache cleared, new version set');
        }
        
        // LocalStorage ìš©ëŸ‰ ì²´í¬ (5MB ì´ìƒì´ë©´ ìºì‹œ ì •ë¦¬)
        let totalSize = 0;
        for (let key in localStorage) {
          if (localStorage.hasOwnProperty(key)) {
            totalSize += (localStorage[key].length + key.length) * 2; // UTF-16
          }
        }
        const sizeInMB = totalSize / (1024 * 1024);
        
        if (sizeInMB > 5) {
          console.warn('[Cache] LocalStorage > 5MB, clearing cache data', sizeInMB.toFixed(2) + 'MB');
          const keysToRemove = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith('sfm:cache:')) {
              keysToRemove.push(key);
            }
          }
          keysToRemove.forEach(key => localStorage.removeItem(key));
        }
        
        // íƒ€ì´í‹€ ì„¤ì •
        const settings = localStorage.getItem('app_settings');
        if (settings) {
          const parsed = JSON.parse(settings);
          const title = parsed.appTitle || 'Goalify';
          
          // ë¸Œë¼ìš°ì € íƒ­ íƒ€ì´í‹€ ì„¤ì •
          document.title = title;
          
          // OG íƒœê·¸ ì„¤ì • (ë§í¬ ê³µìœ  ì‹œ ë¯¸ë¦¬ë³´ê¸°)
          const ogTitle = document.getElementById('og-title');
          if (ogTitle) ogTitle.setAttribute('content', title);
          
          const twitterTitle = document.getElementById('twitter-title');
          if (twitterTitle) twitterTitle.setAttribute('content', title);
        }
      } catch (e) {
        console.error('Failed to load initial setup:', e);
      }
    </script>
  </head>
  <body class="bg-gray-50">
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
