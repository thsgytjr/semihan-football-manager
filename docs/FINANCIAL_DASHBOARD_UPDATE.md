# 재정 대시보드 업데이트 (v2.1)

## 개요
총무가 팀의 재정 상황을 한눈에 파악할 수 있도록 회계 기능에 대시보드가 추가되었으며, UI/UX가 대폭 개선되었습니다.

## 최신 업데이트 (v2.1)

### 구장비 미납 현황 개선 ✨ NEW
- **최신순 정렬**: 가장 최근 매치가 위로 표시
- **클릭 모달**: 매치 클릭 시 상세 모달 오픈
- **Quick Update**: 모달에서 바로 납부 확인 버튼 클릭으로 즉시 처리
- **펼치기 기능**: "더 보기" 버튼으로 모든 미납 매치 확인 가능

### 년도별 필터 ✨ NEW
- 우측 상단에 년도 선택 드롭다운 추가
- 전체 / 2024년 / 2025년 등으로 필터링
- 결제 내역, 매치별 구장비 모두 년도별로 필터 적용

### 선수별 납부 현황 별도 탭 ✨ NEW
- 기존 개요 탭에서 독립된 "선수별 납부" 탭으로 분리
- **컴팩트한 그리드 레이아웃**: 카드 형식으로 한눈에 많은 선수 확인
- **얼굴 아바타 표시**: 각 선수의 프로필 사진 또는 이니셜
- 카드 클릭 시 상세 통계 표시 (가입비, 월회비, 연회비, 구장비)
- 반응형 그리드: 화면 크기에 따라 2-5열로 자동 조정

## 기존 기능 (v2.0)

### 1. 재정 현황 대시보드 (개요 탭)

#### 핵심 지표 카드
- **총 수입**: 모든 수입의 합계
- **총 상환**: 선수들에게 지급한 총 금액 
- **순수익**: 총 수입 - 총 상환
- **구장비 미납**: 미납 인원 수와 미납 금액

#### 수입 구성 파이 차트
가입비, 월회비, 연회비, 구장비의 비율을 시각적으로 표시합니다.
- 각 항목의 금액과 비율(%)을 확인 가능
- 어느 수입원이 가장 큰지 한눈에 파악

#### 월별 수입 트렌드
최근 6개월간의 월별 수입을 바 차트로 표시합니다.
- 수입 증감 추세 확인
- 시즌별 수입 변동 파악

### 2. 구장비 미납자 목록 (매치별 그룹화) ✨ NEW
**매치별로 그룹화하여** 어느 매치에서 누가 미납했는지 명확하게 표시됩니다.

표시 정보:
- 매치 날짜 및 장소
- 해당 매치의 총 미납 금액
- 미납한 선수 목록 (이름, 금액)
- 최대 5개 매치까지 표시 (오래된 순)

**장점**: 매치별로 정리되어 있어 어느 경기의 구장비를 독촉해야 하는지 쉽게 파악 가능

### 3. 매치별 구장비 관리 UI 개선 ✨ NEW

#### 테이블 형식으로 컴팩트하게 변경
기존의 한 선수당 한 줄씩 차지하던 카드 형식에서 **테이블 형식**으로 변경하여 페이지가 훨씬 짧아졌습니다.

테이블 컬럼:
- 선수 (이름 + 사진)
- 구분 (멤버/게스트)
- 금액
- 상태 (완료/미납)
- 작업 (확인/취소 버튼)

#### 납부 확인 취소 기능 ✨ NEW
실수로 확인 버튼을 눌렀을 경우 **취소 버튼**으로 되돌릴 수 있습니다.
- 취소 시 DB에서도 미납으로 업데이트
- payments 테이블에서 해당 기록 삭제
- match_payments 테이블도 pending 상태로 복구

### 4. 구장비 대신 계산한 사람에게 상환 ✨ NEW
매치 상세에서 **구장비를 대신 낸 사람에게 바로 상환**할 수 있습니다.

사용 방법:
1. 매치 생성 시 `paidBy` 필드에 대신 계산한 사람의 ID 저장
2. 매치별 구장비 섹션에서 "💳 OOO님이 대신 결제" 표시
3. **상환 버튼** 클릭하여 즉시 reimbursement 기록 생성
4. 총 구장비 금액만큼 자동으로 상환 처리

### 5. 상환(Reimbursement) 내역
선수들에게 돌려준 금액을 기록하고 관리합니다.

예시:
- 선수가 구장비를 대신 결제한 경우
- 공, 조끼, 기타 물품을 구매한 경우
- 기타 팀을 위해 지출한 비용

상환 기록 방법:
1. 회계 > 결제 내역 > "결제 추가"
2. 유형: "상환" 선택
3. 금액 입력 (양수로 입력)
4. 메모에 사유 기입

**중요**: 상환은 비용이므로 순수익 계산 시 자동으로 차감됩니다.

### 6. 선수별 납부 현황
각 선수를 클릭하면 상세 납부 내역을 확인할 수 있습니다.
- 총 납부 금액
- 가입비 납부 여부
- 매치 참가 횟수

### 7. 회비 리뉴얼 탭 개선 ✨ NEW

#### 납부 방식 자동 판단
각 선수가 **월회비를 내는지 연회비를 내는지** 최근 납부 이력을 기준으로 자동 판단하여 표시합니다.

#### 명확한 상태 표시
- **납부 방식**: 월회비 / 연회비 / 미정
- **최근 납부일**: 가장 최근에 회비를 낸 날짜
- **다음 납부 예정일**: 월회비는 1개월 후, 연회비는 1년 후
- **상태**: 
  - 🔴 **미납** (연체): 다음 납부일이 지남
  - 🟡 **주의** (임박): 월회비 5일 이내, 연회비 10일 이내
  - 🟢 **정상**: 아직 여유 있음

#### 개요 탭에서 중복 제거
리뉴얼 탭이 따로 있으므로 개요 탭의 "회비 리뉴얼 일정" 섹션은 제거되었습니다.

### 8. 회비 설정

## 사용 방법

### 재정 현황 빠르게 확인하기
1. 회계 페이지 접속
2. "개요" 탭 선택
3. 핵심 지표와 차트로 현황 파악

### 매치별 구장비 확인 및 관리
1. "매치별 구장비" 탭 선택
2. 테이블에서 각 선수의 납부 상태 확인
3. 미납자는 "확인" 버튼으로 납부 처리
4. 실수로 확인한 경우 "취소" 버튼으로 되돌리기

### 구장비 미납 확인 (모달 사용)
1. 개요 탭에서 "구장비 미납 현황" 확인
2. 미납 매치 카드 클릭
3. 모달에서 미납 선수 목록 확인
4. 각 선수별로 "납부 확인" 버튼 클릭
5. 자동으로 처리되고 모달 닫힘

### 선수별 납부 통계 확인
1. "선수별 납부" 탭 선택
2. 그리드에서 원하는 선수 카드 클릭
3. 하단에 상세 통계 표시 (가입비, 월회비, 연회비, 구장비)

### 년도별 데이터 조회
1. 우측 상단의 "년도" 드롭다운 선택
2. 원하는 년도 선택 (또는 "전체")
3. 모든 탭의 데이터가 해당 년도로 필터링됨
1. 매치별 구장비 섹션에서 해당 매치 확인
2. "💳 OOO님이 대신 결제" 표시 확인
3. "상환" 버튼 클릭
4. 자동으로 총 구장비 금액만큼 상환 기록 생성

### 구장비 대신 낸 사람에게 상환
1. "리뉴얼" 탭 선택
2. 각 선수의 납부 방식 (월회비/연회비) 확인
3. 상태가 "미납" 또는 "주의"인 선수에게 사전 안내

### 회비 납부 방식 확인
1. "리뉴얼" 탭 선택
2. 각 선수의 납부 방식 (월회비/연회비) 확인
3. 상태가 "미납" 또는 "주의"인 선수에게 사전 안내

## 총무를 위한 팁
1. 상단의 기간 필터 사용
   - "이번 달": 이번 달 데이터만
   - "전체": 모든 데이터
   - "기간 지정": 원하는 기간 선택
2. 차트와 지표가 자동으로 업데이트됨

## 총무를 위한 팁

1. **매주 확인**: 개요 탭을 매주 확인하여 미납자 관리
2. **모달 활용**: 미납 매치 카드를 클릭하여 빠르게 납부 확인 처리
3. **년도별 리뷰**: 년말에 년도 필터로 연간 통계 확인
4. **선수별 추적**: 선수별 납부 탭에서 개별 선수의 납부 패턴 파악
5. **펼치기 기능**: "더 보기"로 모든 미납 매치 한번에 확인

## UI/UX 개선사항 요약

### 컴팩트한 디자인
- 매치별 구장비: 카드 → 테이블로 변경하여 페이지 길이 50% 감소
- 선수별 납부: 그리드 카드 레이아웃으로 한 화면에 많은 정보 표시
- 선수 정보를 아바타 + 이름으로 간결하게 표시

### 명확한 정보 전달
- 구장비 미납: 매치별로 그룹화, 최신순 정렬
- 회비 납부: 월/연 구분, 상태 색상 표시
- 금액 표시: 큰 글씨, 색상으로 강조

### 빠른 작업 흐름
- 모달에서 Quick Update로 클릭 한 번에 납부 처리
- 펼치기/접기로 필요한 정보만 표시
- 년도 필터로 특정 기간 데이터 빠르게 조회

### 실수 방지
- 납부 확인 취소 기능 추가
- 상환 시 확인 대화상자
- 중요 작업 전 확인 절차

## 기술 세부사항

### 새로 추가된 파일
- `src/components/FinancialDashboard.jsx`: 재정 대시보드 메인 컴포넌트
- `src/components/charts/SimpleBarChart.jsx`: 바 차트 컴포넌트
- `src/components/charts/SimplePieChart.jsx`: 파이 차트 컴포넌트

### 수정된 파일
- `src/lib/accounting.js`: 상환(reimbursement) 타입 추가, cancelMatchPayment 함수 추가
- `src/pages/AccountingPage.jsx`: 대시보드 통합, 매치별 구장비 UI 개선, 리뉴얼 탭 개선
- `src/components/FinancialDashboard.jsx`: 구장비 미납자 매치별 그룹화
- `docs/ACCOUNTING_GUIDE.md`: 가이드 업데이트

### 데이터베이스
기존 `payments` 테이블에 새로운 `payment_type` 추가:
- `reimbursement`: 상환

별도의 마이그레이션 불필요 (기존 테이블 구조 그대로 사용)

## 주요 변경사항

### v2.1 추가 기능
- ✅ 구장비 미납 현황 최신순 정렬
- ✅ 미납 매치 클릭 시 모달로 상세 확인
- ✅ 모달에서 Quick Update (납부 확인 버튼)
- ✅ 미납 매치 펼치기/접기 기능
- ✅ 년도별 필터 (전체 탭에 적용)
- ✅ 선수별 납부 현황을 독립 탭으로 분리
- ✅ 컴팩트한 그리드 레이아웃 (2-5열 반응형)
- ✅ 선수 아바타 표시

### v2.0 기능
- ✅ 납부 확인 취소 기능 (cancelMatchPayment)
- ✅ 구장비 대신 낸 사람에게 상환 버튼
- ✅ 구장비 미납자 매치별 그룹화
- ✅ 회비 납부 방식 자동 판단 (월/연)
- ✅ 상태별 색상 표시 (미납/주의/정상)
- ✅ 매치별 구장비: 테이블 형식으로 변경

### 데이터베이스
- 기존 `payments` 테이블 사용 (새로운 payment_type: `reimbursement`)
- 매치 데이터에 `paidBy` 필드 추가 가능 (선택사항)

## 주의사항

- 모든 금액은 양수로 입력 (상환도 양수로 입력하면 자동으로 비용 처리)
- 구장비 미납은 저장된 매치 데이터를 기준으로 계산
- 차트는 외부 라이브러리 없이 순수 SVG로 구현 (가볍고 빠름)
